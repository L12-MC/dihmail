<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}dihmail{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
        <div class="app-shell">
            <aside class="sidebar">
                <div class="logo-wrap">
                        <a href="{{ url_for('about') }}" title="About dihmail">
                            <img src="{{ url_for('static', filename='icons/logo.svg') }}" alt="logo" class="side-logo" />
                        </a>
                </div>
                {% if session.user %}
                <nav class="nav-icons">
                        <a title="Inbox" href="{{ url_for('inbox') }}"><img src="{{ url_for('static', filename='icons/inbox.svg') }}" alt="Inbox" /></a>
                        <a title="Compose" href="{{ url_for('send') }}"><img src="{{ url_for('static', filename='icons/compose.svg') }}" alt="Compose" /></a>
                        <a title="Settings" href="{{ url_for('dashboard') }}"><img src="{{ url_for('static', filename='icons/settings.svg') }}" alt="Settings" /></a>
                    <a title="Logout" href="{{ url_for('logout') }}"><img src="{{ url_for('static', filename='icons/logout.svg') }}" alt="Logout" /></a>
                </nav>
                {% endif %}
            </aside>
            <main class="main-pane">
        <div id="notification-container"></div>
        {% block content %}{% endblock %}
      </main>
    </div>
    <script>
    // Store nav order for directional transitions
    const navOrder = ['{{ url_for("about") }}', '{{ url_for("inbox") }}', '{{ url_for("send") }}', '{{ url_for("dashboard") }}', '{{ url_for("logout") }}'];
    const currentPath = window.location.pathname;
    const currentIndex = navOrder.indexOf(currentPath);
    
    // Store navigation direction in sessionStorage
    if (currentIndex !== -1) {
        sessionStorage.setItem('lastNavIndex', currentIndex);
    }
    
    // Apply entry animation based on previous navigation
    const lastIndex = parseInt(sessionStorage.getItem('lastNavIndex') || currentIndex);
    const mainPane = document.querySelector('.main-pane');
    
    if (mainPane && lastIndex !== currentIndex) {
        if (currentIndex > lastIndex) {
            // Going down in nav - enter from top
            mainPane.style.animation = 'slideUp 0.95s var(--ease-curve)';
        } else {
            // Going up in nav - enter from top
            mainPane.style.animation = 'slideDown 0.95s var(--ease-curve)';
        }
    }
    
    // Intercept navigation clicks
    document.querySelectorAll('.nav-icons a, .logo-wrap a').forEach((link, idx) => {
        link.addEventListener('click', (e) => {
            const targetPath = link.getAttribute('href');
            const targetIndex = navOrder.indexOf(targetPath);
            
            if (targetIndex !== -1 && targetIndex !== currentIndex) {
                e.preventDefault();
                
                // Apply exit animation and navigate immediately
                if (targetIndex > currentIndex) {
                    mainPane.classList.add('page-exit-up');
                } else {
                    mainPane.classList.add('page-exit-down');
                }
                
                window.location.href = targetPath;
            }
        });
    });
    
    // Custom notification system
    function showNotification(message, category = 'info') {
        const container = document.getElementById('notification-container');
        const notification = document.createElement('div');
        notification.className = `notification notification-${category}`;
        
        // Add icon based on category
        let icon = '';
        if (category === 'success') icon = '✓';
        else if (category === 'error') icon = '✕';
        else if (category === 'info') icon = 'ℹ';
        
        notification.innerHTML = `<span class="notification-icon">${icon}</span><span class="notification-text">${message}</span>`;
        container.appendChild(notification);
        
        // Auto-remove after 4 seconds
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.5s var(--notification-curve) forwards';
            setTimeout(() => notification.remove(), 500);
        }, 4000);
    }
    
    // Show flash messages from server
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            window.addEventListener('DOMContentLoaded', () => {
                {% for category, message in messages %}
                    showNotification({{ message|tojson }}, {{ category|tojson }});
                {% endfor %}
            });
        {% endif %}
    {% endwith %}
    </script>
</body>
</html>
